<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>SQL语言之查询与视图</title><meta name="description" content="Shifting eyes and vacancy coming."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="重点与难点

SQL-SELECT: IN | NOT IN, &amp;nbsp;some |&amp;nbsp;&amp;nbsp; all, Exists | NOT Exists
SQL_SELECT: 聚集函数, DROUP BY, HAVING
视图及其应用


一. 子查询

集合成员资格：某一元素是否是某一个集合的成员
集合之间的比较：某一个集合是否包含另一个集合
集合基数的测试：测试集合是否为空、是否存在重复元组

子查询返回一个集合，是出现在Where子句中的Select语句
三种类型的子查询：(NOT) IN—子查询,  some/ all—子查询, (NOT) Exists—子查询
二. SQL语言复杂查询— (NOT) IN子查询
1. (NOT) IN 子查询
1表达式 [not] in (子查询)
例.."><meta name="generator" content="Hexo 6.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">FuLucas's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">SQL语言之查询与视图</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80.-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">一. 子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C.-sql%E8%AF%AD%E8%A8%80%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2-not-in%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">二. SQL语言复杂查询— (NOT) IN子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#not-in-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">1. (NOT) IN 子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">2. 非相关子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">3. 相关子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89.-sql%E8%AF%AD%E8%A8%80%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2-theta-some-%E4%B8%8E-theta-all-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">三. SQL语言复杂查询—  Some 与  All 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#theta-some-%E4%B8%8E-theta-all-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.  Some 与  All 子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">2. 示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-text">3. 注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B.-sql%E8%AF%AD%E8%A8%80%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2-not-exists-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">四. SQL语言复杂查询— (NOT) EXISTS 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exists-%E4%B8%8E-not-exists-%E8%B0%93%E8%AF%8D%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">1. EXISTS 与 NOT EXISTS 谓词子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-text">2. 示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94.-%E5%88%A9%E7%94%A8sql%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E7%BB%93%E6%9E%9C%E8%AE%A1%E7%AE%97%E4%B8%8E%E8%81%9A%E9%9B%86%E8%AE%A1%E7%AE%97"><span class="toc-text">五. 利用SQL语言进行结果计算与聚集计算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C"><span class="toc-text">1. 计算结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-text">2. 聚集函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD.-%E5%88%A9%E7%94%A8-sql-%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E4%B8%8E%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4"><span class="toc-text">六. 利用 SQL 语言进行分组查询与分组过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">1. 分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-text">2. 分组查询示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4"><span class="toc-text">3. 分组过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4%E7%A4%BA%E4%BE%8B"><span class="toc-text">4. 分组过滤示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6%E4%B8%8Ewhere%E6%9D%A1%E4%BB%B6%E4%B9%8B%E5%AF%B9%E6%AF%94"><span class="toc-text">5. 分组过滤条件与WHERE条件之对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83.-sql%E5%AE%9E%E7%8E%B0%E7%8E%B0%E4%BB%A3%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E6%93%8D%E4%BD%9C"><span class="toc-text">七. SQL实现现代关系代数操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E4%BA%A4%E5%B7%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">1. 并交差的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC-null-%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">2. 空值 NULL 的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">3. 内连接、外连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB.-sql-%E8%AF%AD%E8%A8%80%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8"><span class="toc-text">八. SQL 语言之视图及其应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-text">1. 视图的概念和结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-text">2. 视图的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3. 视图的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">4. 视图的更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%92%A4%E9%94%80"><span class="toc-text">5. 视图的撤销</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Database-System"><i class="tag post-item-tag">Database-System</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">SQL语言之查询与视图</h1><time class="has-text-grey" datetime="2022-04-25T10:38:38.000Z">2022-04-25</time><article class="mt-2 post-content"><p><font color="red"><strong><em><u>重点与难点</u></em></strong></font></p>
<ul>
<li><font color="red"><strong><em>SQL-SELECT: IN | NOT IN, <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span>&nbsp;some |&nbsp;<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span>&nbsp; all, Exists | NOT Exists</em></strong></font></li>
<li><font color="red"><strong><em>SQL_SELECT: 聚集函数, DROUP BY, HAVING</em></strong></font></li>
<li><font color="red"><strong><em>视图及其应用</em></strong></font></li>
</ul>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220313151654429.png" alt="image-20220313151654429" style="zoom:67%;"></p>
<h2 id="一.-子查询">一. 子查询</h2>
<ul>
<li><strong><em>集合成员资格：</em></strong>某一元素是否是某一个集合的成员</li>
<li><strong><em>集合之间的比较：</em></strong>某一个集合是否包含另一个集合</li>
<li><strong><em>集合基数的测试：</em></strong>测试集合是否为空、是否存在重复元组</li>
</ul>
<p>子查询返回一个集合，是出现在<strong>Where子句中的Select语句</strong></p>
<p>三种类型的子查询：(NOT) IN—子查询, <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> some/<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> all—子查询, (NOT) Exists—子查询</p>
<h2 id="二.-sql语言复杂查询-not-in子查询">二. SQL语言复杂查询— (NOT) IN子查询</h2>
<h3 id="not-in-子查询">1. (NOT) IN 子查询</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式 [<span class="keyword">not</span>] <span class="keyword">in</span> (子查询)</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> 求既学过001号课程，又学过002号课程的学生的学号</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC</span><br><span class="line"><span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'001'</span> <span class="keyword">and</span> Sid <span class="keyword">in</span></span><br><span class="line">	(<span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'002'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> 列出没学过李明老师讲授课程的所有同学的姓名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sname <span class="keyword">From</span> Student</span><br><span class="line"><span class="keyword">Where</span> Sid <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">	(<span class="keyword">Select</span> Sid <span class="keyword">From</span> Course C, SC, Teacher T</span><br><span class="line">	<span class="keyword">Where</span> T.Tname<span class="operator">=</span><span class="string">'李明'</span> <span class="keyword">and</span> SC.Cid<span class="operator">=</span>C.Cid <span class="keyword">and</span> T.Tid<span class="operator">=</span>C.Tid)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="非相关子查询">2. 非相关子查询</h3>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220312160342954.png" alt="image-20220312160342954" style="zoom:67%;"></p>
<p><strong>非相关子查询：</strong>内层查询<strong>独立</strong>进行，没有涉及任何外层查询相关信息的子查询。</p>
<h3 id="相关子查询">3. 相关子查询</h3>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220312164624471.png" alt="image-20220312164624471" style="zoom:67%;"></p>
<p>相关子查询：内层查询需要依靠外层查询的某些参量作为限定条件才能进行的子查询。</p>
<p>外层向内层传递的参量需要使用外层的表名或表别名来限定。</p>
<p>只能由外层向内层传递参数。</p>
<h2 id="三.-sql语言复杂查询-theta-some-与-theta-all-子查询">三. SQL语言复杂查询— <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> Some 与 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> All 子查询</h2>
<h3 id="theta-some-与-theta-all-子查询">1. <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> Some 与 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> All 子查询</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式 θ <span class="keyword">some</span> (子查询)</span><br></pre></td></tr></tbody></table></figure>
<p>如果表达式的值<strong><em>至少与子查询结果的某一个值</em></strong>相比较满足 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> 关系，则上面表达式的结果便为真；</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式 θ <span class="keyword">all</span> (子查询)</span><br></pre></td></tr></tbody></table></figure>
<p>如果表达式的值<strong><em>与子查询结果的所有值</em></strong>相比较<strong><em>都满足</em></strong> <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container></span> 关系，则上面表达式的结果便为真。</p>
<h3 id="示例">2. 示例</h3>
<p><strong><em>例：</em></strong>找出001号课成绩不是最高的所有学生的学号</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC</span><br><span class="line"><span class="keyword">Where</span> Cid <span class="operator">=</span> “<span class="number">001</span>” <span class="keyword">and</span></span><br><span class="line">	Score <span class="operator">&lt;</span> <span class="keyword">some</span> (<span class="keyword">Select</span> Score <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid <span class="operator">=</span> “<span class="number">001</span>”);</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong>找出所有课程都不及格的学生姓名（相关子查询）</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sname <span class="keyword">From</span> Student</span><br><span class="line"><span class="keyword">Where</span> <span class="number">60</span> <span class="operator">&gt;</span> <span class="keyword">all</span></span><br><span class="line">	(<span class="keyword">Select</span> Score <span class="keyword">From</span> SC <span class="keyword">Where</span> Sid <span class="operator">=</span> Student.Sid );</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong>找出张三同学成绩最低的课程号</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Cid <span class="keyword">From</span> SC, Student S</span><br><span class="line"><span class="keyword">Where</span> Sname <span class="operator">=</span> “张三” <span class="keyword">and</span> S.Sid<span class="operator">=</span>SC.Sid <span class="keyword">and</span> Score <span class="operator">&lt;=</span> <span class="keyword">all</span></span><br><span class="line">	(<span class="keyword">Select</span> Score <span class="keyword">From</span> SC <span class="keyword">Where</span> Sid<span class="operator">=</span>S.Sid);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="注意">3. 注意</h3>
<p><strong><em><u>等价表达式：</u></em></strong></p>
<ul>
<li><strong><em>表达式 = some (子查询)</em></strong> 与 <strong><em>表达式 in (子查询)</em></strong></li>
<li><strong><em>表达式 not in (子查询)</em></strong> 与 <strong><em>表达式 &lt;&gt; all (子查询)</em></strong></li>
</ul>
<h2 id="四.-sql语言复杂查询-not-exists-子查询">四. SQL语言复杂查询— (NOT) EXISTS 子查询</h2>
<h3 id="exists-与-not-exists-谓词子查询">1. EXISTS 与 NOT EXISTS 谓词子查询</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">not</span>] <span class="keyword">Exists</span> (子查询)</span><br></pre></td></tr></tbody></table></figure>
<p>语义：子查询结果中有无元组存在</p>
<h3 id="示例-1">2. 示例</h3>
<p><strong><em>例：</em></strong> <strong>检索选修了赵三老师主讲课程的所有同学的姓名</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">DISTINCT</span> Sname <span class="keyword">From</span> Student</span><br><span class="line"><span class="keyword">Where</span> <span class="keyword">exists</span> (<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SC, Course, Teacher</span><br><span class="line">		<span class="keyword">Where</span> SC.Cid <span class="operator">=</span> Course.Cid	<span class="keyword">and</span> SC. Sid <span class="operator">=</span> Student.Sid</span><br><span class="line">		<span class="keyword">and</span> Course.Tid <span class="operator">=</span> Teacher.Tid <span class="keyword">and</span> Tname <span class="operator">=</span> ‘赵三’ ) ;</span><br></pre></td></tr></tbody></table></figure>
<p>不加not形式的Exists谓词可以不用，写作：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">DISTINCT</span> Sname <span class="keyword">From</span> Student, SC, Course, Teacher</span><br><span class="line"><span class="keyword">Where</span> SC.Cid <span class="operator">=</span> Course.Cid <span class="keyword">and</span> SC.Sid <span class="operator">=</span> Student.Sid</span><br><span class="line">	<span class="keyword">and</span>	Course.Tid <span class="operator">=</span> Teacher.Tid <span class="keyword">and</span> Tname <span class="operator">=</span> ‘赵三’;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>检索学过001号教师主讲的所有课程的所有同学的姓名</strong></p>
<p>即，检索不存在有一门001号教师主讲的课程没学过的同学<font color="red">???????????</font></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sname <span class="keyword">From</span> Student <span class="keyword">Where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> Course <span class="keyword">Where</span> Course.Tid<span class="operator">=</span><span class="string">'001'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">    	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SC <span class="keyword">Where</span> Sid<span class="operator">=</span>Student.Sid <span class="keyword">and</span> Cid<span class="operator">=</span>Course.Cid));</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>列出没学过李明老师讲授任何一门课程的所有同学的姓名</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sname <span class="keyword">From</span> Student <span class="keyword">Where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> Course, SC, Teacher</span><br><span class="line">	<span class="keyword">Where</span> Tname<span class="operator">=</span>‘李明’ <span class="keyword">and</span> Course.Tid <span class="operator">=</span> Teacher.Tid</span><br><span class="line">		<span class="keyword">and</span> Course.Cid <span class="operator">=</span> SC.Cid <span class="keyword">and</span> Sid <span class="operator">=</span> Student.Sid);</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>列出至少学过98030101号同学学过所有课程的同学的学号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> DISTINC Sid <span class="keyword">From</span> SC SC1</span><br><span class="line"><span class="keyword">Where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SC SC2</span><br><span class="line">	<span class="keyword">Where</span> SC2.Sid <span class="operator">=</span> ‘<span class="number">98030101</span>’ <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">		(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid <span class="operator">=</span> SC2.Cid <span class="keyword">and</span> Sid <span class="operator">=</span> SC1.Sid));</span><br></pre></td></tr></tbody></table></figure>
<p>$$ <em>{Sid,Cid}(SC) </em>{Cid}(_{Sid='98030101'}(SC)) \</p>
<p>{ t[Sid]| tSC (u SC u[Sid]='98030101')((wSC)(w[Sid]=t[Sid]w[Cid]=u[Cid])) } $$</p>
<p><strong><em>例：</em></strong> <strong>已知SPJ (Sno, Pno, Jno, Qty)，其中Sno供应商号，Pno零件号，Jno工程号，Qty数量，列出至少用了供应商S1供应的全部零件的工程号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">DISTINCT</span> Jno <span class="keyword">From</span> SPJ SPJ1</span><br><span class="line"><span class="keyword">Where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SPJ SPJ2 <span class="keyword">Where</span> SPJ2.Sno <span class="operator">=</span> ‘S1’ <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">		(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> SPJ SPJ3 <span class="keyword">Where</span> SPJ3.Pno <span class="operator">=</span> SPJ2.Pno <span class="keyword">and</span> SPJ3.Jno <span class="operator">=</span> SPJ1.Jno));</span><br></pre></td></tr></tbody></table></figure>
<h2 id="五.-利用sql语言进行结果计算与聚集计算">五. 利用SQL语言进行结果计算与聚集计算</h2>
<h3 id="计算结果">1. 计算结果</h3>
<p>Select-From-Where语句中，Select子句后面不仅可是列名，而且可是一些<strong><em>计算表达式或聚集函数</em></strong>，表明在投影的同时直接进行一些运算</p>
<ul>
<li>expr可以是常量、列名、或由常量、列名、特殊函数及算术运算符构成的 算术运算式</li>
<li>agfunc()是一些聚集函数</li>
</ul>
<p><strong><em>例：</em></strong> <strong>求有差额(差额&gt;0)的任意两位教师的薪水差额</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> T1.Tname <span class="keyword">as</span> TR1, T2.Tname <span class="keyword">as</span> TR2, T1.Salary – T2.Salary</span><br><span class="line"><span class="keyword">From</span> Teacher T1, Teacher T2</span><br><span class="line"><span class="keyword">Where</span> T1.Salary <span class="operator">&gt;</span> T2.Salary;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>依据学生年龄求学生的出生年份，当前是2015年</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> S.Sid, S.Sname, <span class="number">2015</span> – S.Sage<span class="operator">+</span><span class="number">1</span> <span class="keyword">as</span> Syear</span><br><span class="line"><span class="keyword">From</span> Student S;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="聚集函数">2. 聚集函数</h3>
<p>SQL提供了五个作用在简单列值集合上的内置聚集函数agfunc，分别是： <strong>COUNT、SUM、AVG、MAX、MIN</strong></p>
<figure>
<img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220312202843936.png" alt="image-20220312202843936"><figcaption aria-hidden="true">image-20220312202843936</figcaption>
</figure>
<p><strong><em>例：</em></strong> <strong>求计算机系教师的工资总额</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="built_in">Sum</span>(Salary) <span class="keyword">From</span> Teacher T, Dept</span><br><span class="line"><span class="keyword">Where</span> Dept.Dname <span class="operator">=</span> ‘计算机’ <span class="keyword">and</span> Dept.Did <span class="operator">=</span> T.Did;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>求数据库课程的平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="built_in">AVG</span>(Score) <span class="keyword">From</span> Course C, SC</span><br><span class="line"><span class="keyword">Where</span> C.Cname <span class="operator">=</span> ‘数据库’ <span class="keyword">and</span> C.Cid <span class="operator">=</span> SC.Cid;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="六.-利用-sql-语言进行分组查询与分组过滤">六. 利用 SQL 语言进行分组查询与分组过滤</h2>
<h3 id="分组查询">1. 分组查询</h3>
<p><strong>分组</strong>：SQL可以将检索到的元组按照某一条件进行分类，具有相同条件值的元组划到一个组或一个集合中，同时处理多个组或集合的聚集运算。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 列名<span class="operator">|</span>expr<span class="operator">|</span>agfunc(列名) [[, 列名<span class="operator">|</span>expr<span class="operator">|</span>agfunc(列名)]...]</span><br><span class="line"><span class="keyword">From</span> 表名<span class="number">1</span> [, 表名<span class="number">2.</span>..]</span><br><span class="line">[<span class="keyword">Where</span> 检索条件]</span><br><span class="line">[<span class="keyword">Group</span> <span class="keyword">by</span> 分组条件{列名<span class="number">1</span>, 列名<span class="number">2</span>,...}];</span><br></pre></td></tr></tbody></table></figure>
<h3 id="分组查询示例">2. 分组查询示例</h3>
<p><strong><em>例：</em></strong> <strong>求每一个学生的平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid, <span class="built_in">AVG</span>(Score)</span><br><span class="line"><span class="keyword">From</span> SC <span class="keyword">Group</span> <span class="keyword">by</span> Sid;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>求每一门课程的平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Cid, <span class="built_in">AVG</span>(Score)</span><br><span class="line"><span class="keyword">From</span> SC <span class="keyword">Group</span> <span class="keyword">by</span> Cid;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="分组过滤">3. 分组过滤</h3>
<p><strong>分组过滤</strong>：若要对集合（即分组）进行条件过滤，即满足条件的集合/分组留下，不满足条件的集合/分组剔除。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 列名<span class="operator">|</span>expr<span class="operator">|</span>agfunc(列名) [[, 列名<span class="operator">|</span>expr<span class="operator">|</span>agfunc(列名)]...]</span><br><span class="line"><span class="keyword">From</span> 表名<span class="number">1</span> [, 表名<span class="number">2.</span>..]</span><br><span class="line">[<span class="keyword">Where</span> 检索条件]</span><br><span class="line">[<span class="keyword">Group</span> <span class="keyword">by</span> 分组条件 [<span class="keyword">Having</span> 分组过滤条件]];</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Having子句，又称分组过滤子句</strong>，需要有Group by子句支持。</p>
<h3 id="分组过滤示例">4. 分组过滤示例</h3>
<p><strong><em>例：</em></strong> <strong>求不及格课程超过两门的同学的学号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">by</span> Sid <span class="keyword">Having</span> <span class="built_in">Count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>求有10人以上不及格的课程号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Cid <span class="keyword">From</span> SC <span class="keyword">Where</span> Score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">by</span> Cid	<span class="keyword">Having</span> <span class="built_in">Count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">10</span>;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="分组过滤条件与where条件之对比">5. 分组过滤条件与WHERE条件之对比</h3>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220313105138002.png" alt="image-20220313105138002" style="zoom:67%;"></p>
<p><strong><em>例：</em></strong> <strong>求有两门以上不及格课程同学的学号及其平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid, <span class="built_in">Avg</span>(Score) <span class="keyword">From</span> SC</span><br><span class="line"><span class="keyword">Where</span> Sid <span class="keyword">in</span></span><br><span class="line">	(<span class="keyword">Select</span> Sid <span class="keyword">From</span>	SC <span class="keyword">Where</span> Score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line">	<span class="keyword">Group</span> <span class="keyword">by</span> Sid	<span class="keyword">Having</span> <span class="built_in">Count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>)</span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">by</span> Sid;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>该同学那几门不及格课程的平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid, <span class="built_in">Avg</span>(Score) <span class="keyword">From</span> SC <span class="keyword">Where</span> Score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">by</span> Sid <span class="keyword">Having</span> <span class="built_in">Count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="七.-sql实现现代关系代数操作">七. SQL实现现代关系代数操作</h2>
<h3 id="并交差的处理">1. 并交差的处理</h3>
<p><strong><em><u>SQL 语言：并运算 UNION，交运算 INTERSECT， 差运算 EXCEPT</u></em></strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">子查询 <span class="keyword">Union</span> <span class="operator">|</span> <span class="keyword">Intersect</span> <span class="operator">|</span> <span class="keyword">Except</span> [<span class="keyword">ALL</span>] 子查询</span><br></pre></td></tr></tbody></table></figure>
<p>不带ALL自动删除重复元组，若保留ALL则也保留重复元组。（对集合和对包的操作的区别）</p>
<p><strong>假设子查询1的一个元组出现m次，子查询2的一个元组出现n次，则该元组在：</strong></p>
<ul>
<li>子查询1 Union ALL 子查询2 ，出现 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex" xmlns="http://www.w3.org/2000/svg" width="6.11ex" height="1.505ex" role="img" focusable="false" viewBox="0 -583 2700.4 665"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1100.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2100.4,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span> 次</li>
<li>子查询1 Intersect ALL 子查询2 ，出现 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="10.235ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4523.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(878,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1223,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1823,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2212,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3090,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(3534.7,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4134.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span> 次</li>
<li>子查询1 Except ALL 子查询2 ，出现 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="12.85ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 5679.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(878,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1407,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1979,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2368,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(2868,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(3312.7,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(4190.7,0)"><g data-mml-node="mo"><path data-c="2013" d="M0 248V285H499V248H0Z"></path></g></g><g data-mml-node="mi" transform="translate(4690.7,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(5290.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span> 次</li>
</ul>
<p><strong><em>例：</em></strong> <strong>求学过002号课的同学或学过003号课的同学学号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'002'</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'003'</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>求既学过002号课，又学过003号课的同学学号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'002'</span></span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span> Cid<span class="operator">=</span><span class="string">'003'</span>;</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Intersect 没有增加SQL语言的表达能力（可以用 IN 来代替）</p>
</blockquote>
<p><strong><em>例：</em></strong> <strong>假定所有学生都有选课，求没学过002号课程的学生学号</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">DISTINCT</span>	Sid <span class="keyword">From</span> SC</span><br><span class="line"><span class="keyword">EXCEPT</span></span><br><span class="line"><span class="keyword">Select</span> Sid <span class="keyword">From</span> SC <span class="keyword">Where</span>	Cid <span class="operator">=</span> ‘<span class="number">002</span>’;</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Except 也没有增加SQL语言的表达能力（可以用 Not Exists 来代替）</p>
</blockquote>
<p><strong><em><u>但有些DBMS并不支持这些运算</u></em></strong></p>
<h3 id="空值-null-的处理">2. 空值 NULL 的处理</h3>
<p>空值检测：注意不是等于（=）！！！</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">is</span> [<span class="keyword">not</span>] <span class="keyword">null</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>找出年龄值为空的学生姓名</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Sname <span class="keyword">From</span> Student</span><br><span class="line"><span class="keyword">Where</span> Sage <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em><u>DBMS 空值处理：</u></em></strong></p>
<ul>
<li>除 is [not] null 之外，空值不满足任何查找条件</li>
<li>null参与<strong>算术</strong>运算，则该算术结果为null</li>
<li>null参与<strong>比较运算</strong>，则结果可视为<strong>false</strong>（在SQL-92中可看成 unknown）</li>
<li>null参与<strong>聚集运算</strong>，则**除 count(*) 之外<strong>其它聚集函数都</strong>忽略** null</li>
</ul>
<h3 id="内连接外连接">3. 内连接、外连接</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 列名 [[, 列名]...]</span><br><span class="line"><span class="keyword">From</span> 表名<span class="number">1</span> [<span class="keyword">NATURAL</span>]</span><br><span class="line">		  [<span class="keyword">INNER</span> <span class="operator">|</span> {<span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> <span class="operator">|</span> <span class="keyword">FULL</span>} [<span class="keyword">OUTER</span>]] <span class="keyword">JOIN</span> 表名<span class="number">2</span></span><br><span class="line">	{<span class="keyword">ON</span> 连接条件 <span class="operator">|</span> <span class="keyword">Using</span> (Colname {, Colname...})}</span><br><span class="line">[<span class="keyword">Where</span>	检索条件]...;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220313154221824.png" alt="image-20220313154221824" style="zoom: 80%;"></p>
<ul>
<li><strong><em>natural：</em></strong>自然连接，公共属性取值相同，且只出现一次</li>
<li><strong><em>on &lt;连接条件&gt;：</em></strong>满足条件，公共属性出现两次</li>
<li><strong><em>using (Col1, Col2, ..., Coln)：</em></strong>连接关系的公共属性子集</li>
</ul>
<p><strong><em>例：</em></strong> <strong>求所有教师的任课情况并按教师号排序</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Teacher.Tid, Tname, Cname</span><br><span class="line"><span class="keyword">From</span> Teacher <span class="keyword">Inner</span> <span class="keyword">Join</span>	Course</span><br><span class="line">	<span class="keyword">ON</span> Teacher.Tid <span class="operator">=</span> Course.Tid</span><br><span class="line"><span class="keyword">Order</span> <span class="keyword">by</span> Teacher.Tid	<span class="keyword">ASC</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>求所有教师的任课情况（没有任课的教师也需列在表中）</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Teacher. Tid, Tname, Cname</span><br><span class="line"><span class="keyword">From</span> Teacher <span class="keyword">Left</span> <span class="keyword">Outer</span> <span class="keyword">Join</span> Course</span><br><span class="line">	<span class="keyword">ON</span> Teacher.Tid <span class="operator">=</span> Course.Tid</span><br><span class="line"><span class="keyword">Order</span> <span class="keyword">by</span> Teacher.Tid	<span class="keyword">ASC</span> ;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="八.-sql-语言之视图及其应用">八. SQL 语言之视图及其应用</h2>
<h3 id="视图的概念和结构">1. 视图的概念和结构</h3>
<blockquote>
<p>对应概念模式的数据在SQL中被称为<strong>基本表(Table)</strong>，而对应外模式的数据称为<strong>视图(View)</strong>。<strong>视图不仅包含外模式，而且包含其E-C映像。</strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/FuLucas/image/main/2022/image-20220313155502916.png" alt="image-20220313155502916" style="zoom:67%;"></p>
<ul>
<li><p>基本表是实际存储于存储文件中的表，基本表中的数据是需要存储的；</p></li>
<li><p>视图在SQL中只存储其由基本表导出视图所需要的公式，即由基本表产生视图的映像信息，其数据并不存储，而是在运行过程中动态产生与维护的；</p></li>
<li><p>对视图数据的更改最终要反映在对基本表的更改上。</p></li>
</ul>
<h3 id="视图的定义">2. 视图的定义</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> view_name [(列名 [，列名]...)]</span><br><span class="line">	<span class="keyword">as</span> 子查询 [<span class="keyword">with</span> <span class="keyword">check</span> option]</span><br></pre></td></tr></tbody></table></figure>
<p>with check option指明当对视图进行insert，update，delete时，要检查进行insert/update/delete的元组是否满<strong>足视图定义中子查询中定义的条件表达式</strong></p>
<p><strong><em>例：</em></strong> <strong>定义一个视图 CompStud 为计算机系的学生，通过该视图可以将 Student 表中其他系的学生屏蔽掉</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">View</span>	CompStud <span class="keyword">AS</span></span><br><span class="line">	(<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> Student</span><br><span class="line">	<span class="keyword">Where</span> Did <span class="keyword">in</span> (<span class="keyword">Select</span> Did <span class="keyword">From</span> Dept</span><br><span class="line">				<span class="keyword">Where</span> Dname <span class="operator">=</span> ‘计算机’));</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>定义一个视图Teach为教师任课的情况，把Teacher表中的个人隐私方面的信息屏蔽掉，仅反映其教哪门课及其学分等。</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">View</span> Teach <span class="keyword">AS</span></span><br><span class="line">	(<span class="keyword">Select</span> T.Tname, C.Cname, Credit</span><br><span class="line">    <span class="keyword">From</span> Teacher T, Course C</span><br><span class="line">    <span class="keyword">Where</span> T.Tid<span class="operator">=</span>C.Tid);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="视图的使用">3. 视图的使用</h3>
<p>定义好的视图，可以像Table一样，在SQL各种语句中使用</p>
<p><strong><em>例：</em></strong> <strong>检索计算机系的年龄小于20的所有学生</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> CompStud <span class="keyword">Where</span> Sage <span class="operator">&lt;</span> <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><strong><em>例：</em></strong> <strong>检索主讲数据库课程的教师姓名</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> T.Tname <span class="keyword">From</span> Teach T <span class="keyword">Where</span> T.Cname <span class="operator">=</span> ‘数据库’;</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>定义视图，有时可方便用户进行<strong>检索操作</strong></p>
</blockquote>
<p><strong><em>例：</em></strong> <strong>定义视图StudStat，描述学生的平均成绩、最高成绩、最低成绩等，基于视图检索某一学生平均成绩</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">View</span> StudStat(Sid, Sname, AvgS, MinS, MaxS, CNT)</span><br><span class="line"><span class="keyword">as</span> (<span class="keyword">Select</span> Sid, Sname, <span class="built_in">AVG</span>(Score), <span class="built_in">MIN</span>(Score), <span class="built_in">Max</span>(Score), <span class="built_in">Count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">From</span> Student S, SC <span class="keyword">Where</span> S.Sid <span class="operator">=</span> SC.Sid</span><br><span class="line">	<span class="keyword">Group</span> <span class="keyword">by</span> S.Sid);</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Sname, AvgS <span class="keyword">From</span> StudStat <span class="keyword">Where</span> Sname <span class="operator">=</span> ‘张三’;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="视图的更新">4. 视图的更新</h3>
<p>因视图不保存数据，对视图的更新最终要<strong>反映到对基本表的更新</strong>上，而有时视图定义的映射<strong>不是可逆</strong>的。</p>
<blockquote>
<p>对于由<strong>单一Table</strong>子集构成的视图，即如果视图是从单个基本表使用<strong>选择、投影</strong>操作导出的，并且包含了基本表的<strong>主键</strong>，则可以更新</p>
</blockquote>
<p><strong><em>不能更新的情况：</em></strong></p>
<ul>
<li>视图的select目标列包含<strong>聚集函数</strong></li>
<li>如果视图的select子句使用了<strong>unique或distinct</strong></li>
<li>如果视图中包括了<strong>group by子句</strong></li>
<li>如果视图中包括经<strong>算术表达式计算</strong>出来的列</li>
<li>如果视图是由单个表的列构成，但并<strong>没有包括主键</strong></li>
</ul>
<h3 id="视图的撤销">5. 视图的撤销</h3>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Drop</span> <span class="keyword">View</span> view_name;</span><br></pre></td></tr></tbody></table></figure>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2022/04/27/Database%20System/08-SQL%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%AE%8C%E6%95%B4%E6%80%A7%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7/" title="SQL语言之完整性与安全性"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: SQL语言之完整性与安全性</span></a><a class="button is-default" href="/2022/04/23/Database%20System/06-SQL%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%A6%82%E8%A7%88/" title="SQL语言之概览"><span class="has-text-weight-semibold">Next: SQL语言之概览</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/FuLucas"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> FuLucas 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>